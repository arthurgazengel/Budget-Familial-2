

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Budget Familial</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    .category-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }
  </style>
</head>
<body class="bg-gray-50 font-sans">
  <div class="min-h-screen flex flex-col">
    <header class="gradient-bg text-white shadow-lg">
      <div class="container mx-auto px-4 py-6 flex justify-between items-center">
        <div>
          <h1 class="text-2xl md:text-3xl font-bold">Budget Familial</h1>
          <p class="text-blue-100">Suivi des dépenses du foyer</p>
        </div>
        <div class="flex items-center space-x-4">
          <button id="syncBtn" class="bg-white text-purple-700 px-4 py-2 rounded-lg font-medium hover:bg-purple-50 transition-all">
            <i class="fas fa-sync-alt mr-2"></i> Synchroniser
          </button>
          <div class="hidden md:block bg-white bg-opacity-20 px-4 py-2 rounded-lg">
            <p class="text-sm">Budget actuel</p>
            <p class="font-bold text-xl" id="currentBalance">€0.00</p>
          </div>
        </div>
      </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 space-y-8">
          <!-- Résumés -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-xl shadow-md p-6"><p class="text-gray-500">Dépenses ce mois</p><p class="text-2xl font-bold text-red-500" id="monthExpenses">€0.00</p></div>
            <div class="bg-white rounded-xl shadow-md p-6"><p class="text-gray-500">Économies</p><p class="text-2xl font-bold text-green-500" id="savings">€0.00</p></div>
            <div class="bg-white rounded-xl shadow-md p-6"><p class="text-gray-500">Budget restant</p><p class="text-2xl font-bold text-blue-500" id="remainingBudget">€0.00</p></div>
          </div>

          <!-- Graphiques -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Répartition des dépenses</h2>
            <canvas id="expensesChart" height="200"></canvas>
          </div>

          <!-- Formulaire -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6">Ajouter une dépense</h2>
            <form id="expenseForm" class="space-y-4">
              <input type="number" step="0.01" id="amount" placeholder="Montant (€)" required class="w-full px-4 py-2 border rounded-lg" />
              <input type="date" id="date" required class="w-full px-4 py-2 border rounded-lg" />
              <select id="category" required class="w-full px-4 py-2 border rounded-lg">
  <option value="">Choisir une catégorie</option>
  <option value="Amazon etc.">Amazon etc.</option>
  <option value="Courses">Courses</option>
  <option value="Logement">Logement</option>
  <option value="Transport">Transport</option>
  <option value="Loisirs">Loisirs</option>
  <option value="Vacances">Vacances</option>
  <option value="Santé">Santé</option>
  <option value="Restaurant">Restaurant</option>
  <option value="Autres">Autres</option>
  <option value="Chat">Chat</option>
  <option value="Cadeaux">Cadeaux</option>
</select>

              <textarea id="description" rows="2" placeholder="Description" class="w-full px-4 py-2 border rounded-lg"></textarea>
              <button type="submit" class="w-full bg-purple-600 text-white py-2 rounded-lg font-medium hover:bg-purple-700">Ajouter</button>
            </form>
          </div>

          <!-- Dépenses récentes -->
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800">Dépenses récentes</h2>
            <div id="recentExpenses" class="space-y-4 mt-4"></div>
          </div>
        </div>
        <div>
          <div class="bg-white rounded-xl shadow-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-6">Historique des dépenses</h2>
            <div id="expenseHistory" class="space-y-3 max-h-96 overflow-y-auto pr-2"></div>
          </div>
        </div>
      </div>
    </main>

    <footer class="bg-gray-800 text-white py-6 text-center">
      <p>Suivi des dépenses connecté à Google Sheets via SheetDB</p>
    </footer>
  </div>

  <script>
    const ctx = document.getElementById('expensesChart').getContext('2d');
    const expensesChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: [],
        datasets: [{
          label: 'Dépenses',
          data: [],
          backgroundColor: ['#EF4444', '#8B5CF6', '#10B981', '#3B82F6', '#F59E0B', '#EC4899', '#6B7280']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' }
        }
      }
    });

    function formatCurrency(amount) {
      return new Intl.NumberFormat('fr-FR', { style: 'currency', currency: 'EUR' }).format(amount);
    }

    function getCurrentDate() {
      return new Date().toISOString().split('T')[0];
    }

    async function loadData() {
      try {
        const res = await fetch('https://api.sheety.co/c6acf955624fc4abe98095d8338c18ba/budgetFamilialLandingPage/feuille1');
        const json = await res.json();
        const data = json.feuille1.reverse();

        const recent = document.getElementById('recentExpenses');
        const history = document.getElementById('expenseHistory');
        recent.innerHTML = '';
        history.innerHTML = '';

        let total = 0;
        let catTotals = {};
        data.forEach((item, i) => {
          const m = parseFloat(item.montant || 0);
          total += m;
          catTotals[item.categorie] = (catTotals[item.categorie] || 0) + m;

          const html = `
            <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
              <div><p class="font-medium">${item.categorie}</p><p class="text-sm text-gray-500">${item.description || ''}</p></div>
              <div class="text-right"><p class="font-medium text-red-500">-${formatCurrency(m)}</p><p class="text-xs text-gray-500">${item.date}</p></div>
            </div>`;
          if (i < 3) recent.innerHTML += html;
          history.innerHTML += html;
        });

        document.getElementById('monthExpenses').textContent = formatCurrency(total);
        document.getElementById('savings').textContent = formatCurrency(500);
        document.getElementById('remainingBudget').textContent = formatCurrency(2000 - total);
        document.getElementById('currentBalance').textContent = formatCurrency(2500 - total);

        expensesChart.data.labels = Object.keys(catTotals);
        expensesChart.data.datasets[0].data = Object.values(catTotals);
        expensesChart.update();
      } catch (e) {
        alert("Erreur de chargement");
        console.error(e);
      }
    }

    async function addExpense(expense) {
      try {
        await fetch('https://sheetdb.io/api/v1/giny608orux62', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ data: expense })
        });
        alert("Dépense ajoutée !");
        loadData();
        document.getElementById('expenseForm').reset();
        document.getElementById('date').value = getCurrentDate();
      } catch (e) {
        alert("Erreur lors de l'ajout.");
        console.error(e);
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('date').value = getCurrentDate();
      loadData();
      document.getElementById('syncBtn').addEventListener('click', loadData);
      document.getElementById('expenseForm').addEventListener('submit', e => {
        e.preventDefault();
        const expense = {
          montant: document.getElementById('amount').value,
          date: document.getElementById('date').value,
          categorie: document.getElementById('category').value,
          description: document.getElementById('description').value,
        };
        addExpense(expense);
      });
    });
  </script>
</body>
</html>
